<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  
  <link rel="shortcut icon" href="../img/favicon.ico">
  <title>Create docker container - Event-driven seismic imaging in the cloud</title>
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  <link rel="stylesheet" href="../css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../css/theme_extra.css" type="text/css" />
  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css">
  
  <script>
    // Current page data
    var mkdocs_page_name = "Create docker container";
    var mkdocs_page_input_path = "docker.md";
    var mkdocs_page_url = null;
  </script>
  
  <script src="../js/jquery-2.1.1.min.js" defer></script>
  <script src="../js/modernizr-2.8.3.min.js" defer></script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script> 
  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
      <div class="wy-side-nav-search">
        <a href=".." class="icon icon-home"> Event-driven seismic imaging in the cloud</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
	<ul class="current">
	  
          
            <li class="toctree-l1">
		
    <a class="" href="..">Home</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../roles/">Create IAM roles</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../batch/">Set up batch environment</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../lambda/">Upload Lambda functions</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../sqs/">Create message queues</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../step/">Step Functions</a>
	    </li>
          
            <li class="toctree-l1 current">
		
    <a class="current" href="./">Create docker container</a>
    <ul class="subnav">
            
    <li class="toctree-l2"><a href="#docker">Docker</a></li>
    
        <ul>
        
            <li><a class="toctree-l3" href="#single-node-batch-jobs">Single-node batch jobs</a></li>
        
            <li><a class="toctree-l3" href="#multi-node-batch-jobs">Multi-node batch jobs</a></li>
        
        </ul>
    

    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../performance/">Performance tests</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../trouble/">Troubleshooting</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../about/">About</a>
	    </li>
          
        </ul>
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="..">Event-driven seismic imaging in the cloud</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="..">Docs</a> &raquo;</li>
    
      
    
    <li>Create docker container</li>
    <li class="wy-breadcrumbs-aside">
      
    </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <h1 id="docker">Docker</h1>
<p>The required Docker images for the workflow are publicly available on Docker hub. The Docker image used by AWS Batch is specified in the job parameter files of the numerical examples (e.g. <code>~/cloud-imaging/numerical_examples/imaging_example_sgd/parameters.json</code>). In the current set up, all single-node batch jobs use the pre-existing Docker image <code>aws_seismic_imaging:v1.0</code>. To (optionally) obtain a local copy of the image, run:</p>
<pre><code>docker pull philippwitte/aws_seismic_imaging:v1.0
</code></pre>

<p>All multi-node batch jobs use the per-exisiting Docker image <code>aws_seismic_imaging_mpi:v1.0</code>. Obtain an (optional) local copy with:</p>
<pre><code>docker pull philippwitte/aws_seismic_imaging_mpi:v1.0
</code></pre>

<p>To reproduce the numerical examples, no actions regarding Docker are necessary.</p>
<h2 id="single-node-batch-jobs">Single-node batch jobs</h2>
<p>To update or modify the Docker container for single node batch jobs, first pull the current version of the image with the above command. Update the Dockerfile in <code>~/cloud-imaging/docker/single_node_batch</code> as desired and then rebuild the Docker image with a new tag (e.g. <code>v1.1</code>):</p>
<pre><code>cd ~/cloud-imaging/docker/single_node_batch
docker build -t aws_seismic_imaging:tag .
</code></pre>

<p>As users cannot store their modified images on the original <code>philippwitte</code> Docker hub, you will upload the new image to your AWS account. First, you need to obtain login credentials by AWS. Copy-paste the output of the following command back into the terminal:</p>
<pre><code># Get ECR login credentials and use the token that is printed in the terminal
aws ecr get-login --no-include-email
</code></pre>

<p>If the log in was successful, you will see the message "Login Succeeded" in your terminal. Next, create a repository on AWS called <code>aws_seismic_imaging</code>:</p>
<pre><code># Create repository (only first time)
aws ecr create-repository --repository-name aws_seismic_imaging
</code></pre>

<p>Now, tag the new image using the URI of the repository that you just created. To find the URI of your repository, go to the AWS console -&gt; <code>Services</code> -&gt; <code>ECR</code> -&gt; <code>aws_seismic_imaging</code>. Tag your image by running:</p>
<pre><code># tag image
docker tag aws_seismic_imaging:tag URI:tag
</code></pre>

<p>Finally, upload your Docker image to your AWS container registry:</p>
<pre><code>docker push URI:tag
</code></pre>

<p>Note the full name of your new image (<code>URI:tag</code>) and update the job parameter files correspondingly.</p>
<h2 id="multi-node-batch-jobs">Multi-node batch jobs</h2>
<p>Updating or modifying the Docker image for multi-node AWS Batch jobs follows the same steps as the previous instructions. Namely, modify the Dockerfile in <code>~/cloud-imaging/docker/multi_node_batch</code> and rebuild the image using a new tag (e.g. <code>v1.1</code>)</p>
<pre><code>cd ~/cloud-imaging/docker/multi_node_batch
docker build -t aws_seismic_imaging_mpi:tag .
</code></pre>

<p>Tag the image, obtain the AWS ECR log-in credentials and push it to the ECR by following the steps from above. (Replace all instances of <code>aws_seismic_imaging</code> in the instructions with <code>aws_seismic_imaging_mpi</code>.)</p>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../performance/" class="btn btn-neutral float-right" title="Performance tests">Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="../step/" class="btn btn-neutral" title="Step Functions"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
  </div>

  Built with <a href="http://www.mkdocs.org">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
      
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" style="cursor: pointer">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
      
        <span><a href="../step/" style="color: #fcfcfc;">&laquo; Previous</a></span>
      
      
        <span style="margin-left: 15px"><a href="../performance/" style="color: #fcfcfc">Next &raquo;</a></span>
      
    </span>
</div>
    <script>var base_url = '..';</script>
    <script src="../js/theme.js" defer></script>
      <script src="../search/main.js" defer></script>

</body>
</html>
